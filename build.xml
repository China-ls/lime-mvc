<project name="Lime" basedir="." default="test">
	
	<property name="version" value="0.0.1" />
	<property name="lib"  location="${basedir}/lib"/>
	<property name="build" location="${basedir}/build"/>
	<property name="test" location="${basedir}/test"/>
	<property name="docs" location="${basedir}/docs/javadoc"/>
		
	<property name="lime.src"     location="${basedir}/src" />	
	<property name="lime.classes" location="${build}/classes" /> 
	<property name="lime.dest"    location="${build}/artifacts" />
		
	<property name="test.unit"        location="${test}/unit"/>
	<property name="test.integration" location="${test}/integration"/>
	<property name="test.output"      location="${build}/test-output"/>
	<property name="test.classes"     location="${build}/test"/>
	
	
	<target name="clean">
		<delete dir="${build}" />
		<delete dir="${docs}" />
	</target>

	<target name="init">
		<mkdir dir="${lib}" />
		<mkdir dir="${build}" />
		<mkdir dir="${lime.classes}" />
		<mkdir dir="${lime.dest}" />	
		<mkdir dir="${test.classes}"/>
		<mkdir dir="${test.output}" />
		<mkdir dir="${docs}" />
	</target>
	
	<!-- BUILD LIME -->
	<target name="compile" depends="init">
		<javac srcdir="${lime.src}" destdir="${lime.classes}" includeantruntime="true" debug="on">
			<classpath>
				<fileset dir="${lib}">
					<include name="**/*.jar" />
				</fileset>
			</classpath>
		</javac>
	</target>
	
	<target name="doc">
		<mkdir dir="${docs}" />
		<javadoc destdir="${docs}">
			<fileset dir="${basedir}/" includes="src/**/*.java" />
		</javadoc>
	</target>
	
	<target name="dist" depends="compile, doc">
		<jar jarfile="${lime.dest}/lime.jar">
			<fileset dir="${lime.classes}" />
		</jar>
		
		<jar jarfile="${lime.dest}/lime-with-libraries.jar">
			<fileset dir="${lime.classes}" />
			<fileset dir="${lib}/required" />
			<manifest>
				<attribute name="Class-Path" value="."/>
			</manifest>
		</jar>
	</target>

	
	
	<!-- TEST LIME -->
	<path id="test.lib.path">
		<fileset dir="${lib}">
			<include name="**/*.jar" />
		</fileset>		
	</path>

	<taskdef name="testng" classname="org.testng.TestNGAntTask">
		<classpath refid="test.lib.path"/>
	</taskdef>
	
	<target name="compile-tests-unit" depends="compile">
		<javac srcdir="${test.unit}/src" destdir="${test.classes}" includeantruntime="true" debug="on">
			<classpath>
				<fileset dir="${lib}">
					<include name="**/*.jar" />
				</fileset>
				<pathelement path="${lime.classes}"/>
			</classpath>
		</javac>
	</target>
	
	<target name="compile-tests-integration" depends="compile">
		<javac srcdir="${test.integration}/src" destdir="${test.classes}" includeantruntime="true" debug="on">
			<classpath>
				<fileset dir="${lib}">
					<include name="**/*.jar" />
				</fileset>
				<pathelement path="${lime.classes}"/>
			</classpath>
		</javac>
		
	</target>
	
	<target name="test" depends="compile-tests-unit, compile-tests-integration">
		<testng outputdir="${test.output}" workingDir=".">
			<classpath>
				<fileset dir="${lib}">
					<include name="**/*.jar" />
				</fileset>
				<pathelement path="${lime.classes}"/>
				<pathelement path="${test.classes}"/>
			</classpath>			
			<xmlfileset dir="." includes="testng.xml"/>
		</testng>
	</target>
 
</project>
